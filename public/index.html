<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <title>Dropmail</title>
    <link href='css/dropmail.css' rel='stylesheet'>
  </head>

  <body>
    <div class='container'>
      <div class='row'>
        <div class='span12'>
          <div class='navbar'>
            <ul class='nav pull-right actions'>
              <li><a href='#'>Features</a></li>
              <li><a href='#'>Pricing</a></li>
            </ul>
          </div>
          <div class='header-logo'>
            <a href='/'>Dropmail</a>
          </div>
        </div>
      </div>

      <div class='row'>
        <div class='span9'>
          <h1>Powerful transactional email management</h1>
          <p class='lead'>Empowering people to get shit done</p>
        </div>

        <div class='span3'>
          <form action='#' class='signup'>
            <div class='control-group'>
              <div class='controls'>
                <input type='text' name='name' placeholder='First Last'>
              </div>
            </div>
            <div class='control-group'>
              <div class='controls'>
                <input type='text' name='email' placeholder='user@example.com'>
              </div>
            </div>
            <div class='control-group'>
              <div class='controls'>
                <input type='password' name='password' placeholder='••••••••'>
              </div>
            </div>
            <button class='btn btn-primary' type='submit'>Sign Up</button>
          </form>
        </div>
      </div>
    </div>

    <script src='http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js'></script>
    <script src='js/dropmail.js'></script>

    <script>
      Dropmail.Model.baseURL = 'http://0.0.0.0:9393';
      Dropmail.Model.key = 'w9GxuBn8ZeujTdIz1dSurEsmPkBbi1Wq2R53EW0mXY4';

      var $form = $('form.signup');
      $(function(){
        $form.on('submit', function(){
          var params = {}
            , user;
          $.each($(this).serializeArray(), function(){
            params[this.name] = this.value;
          });

          user = Dropmail.User.create(params, function(err, user){
            $form.find('.control-group').removeClass('error');
            $form.find('.help-block').remove();

            if (err) {
              var errors = err.attributes;

              for (var name in errors) {
                var input = $('input[name=' + name + ']')
                input.closest('.control-group').addClass('error');
                input.after("<div class='help-block'>" + errors[name] + '<' + '/div>');
              }
            }
          });

          return false;
        });
      });
    </script>
  </body>
</html>
